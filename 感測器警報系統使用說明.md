# 感測器警報系統使用說明

## 系統概述

感測器警報系統是一個智能監控解決方案，能夠自動檢測感測器數值是否超出正常範圍，並根據異常程度提供不同等級的視覺和音頻警報。

## 主要功能

### 1. 智能數值檢測
- 自動監控溫度、濕度、CO2、風速等感測器數值
- 根據預設閾值判斷異常等級
- 支援自定義警報範圍設定

### 2. 多等級警報系統
- **警告 (Warning)**: 數值超出正常範圍，需要關注
- **危險 (Danger)**: 數值嚴重異常，需要立即處理
- **臨界 (Critical)**: 數值極度異常，緊急處理

### 3. 視覺警報效果
- 感測器卡片邊框顏色變化
- 動畫效果（脈動、閃爍）
- 警報圖示顯示
- 數值顏色變化

### 4. 音頻警報
- 不同等級對應不同頻率音頻
- 自動播放警報聲
- 防止音頻重疊播放

### 5. 離線檢測
- 感測器超過30秒沒更新即報警
- 離線狀態視覺指示
- 自動恢復在線偵測

## 系統架構

### 前端組件
- `sensor-alert.js`: 核心警報系統
- `style.css`: 警報樣式和動畫
- `app.js`: 主要應用邏輯整合

### 頁面功能
- **警報演示頁面** (`/alert-demo`): 測試警報效果
- **場域詳情頁面**: 即時警報顯示與個別感測器配置
- **儀表板頁面**: 輪播警報監控

## 使用方法

### 1. 基本設定

#### 警報閾值配置
1. 導航到「警報配置」頁面
2. 設定各感測器類型的正常、警告、危險、臨界範圍
3. 點擊「儲存配置」按鈕

#### 預設配置
```javascript
// 溫度感測器 (°C)
正常範圍: 15 - 35
警告範圍: 10 - 40
危險範圍: 5 - 45
臨界範圍: 0 - 50

// 濕度感測器 (%)
正常範圍: 40 - 80
警告範圍: 30 - 90
危險範圍: 20 - 95
臨界範圍: 10 - 100

// CO2感測器 (ppm)
正常範圍: 300 - 1000
警告範圍: 200 - 1500
危險範圍: 100 - 2000
臨界範圍: 50 - 3000
```

### 2. 警報測試

#### 單一感測器測試
- 點擊感測器卡片下方的測試按鈕
- 選擇警告、危險或臨界等級
- 觀察視覺和音頻效果

#### 批量測試
- 使用「測試所有警告」等批量按鈕
- 自動循環測試不同等級
- 監控警報計數器和日誌

### 3. 即時監控

#### 場域佈局圖
- 感測器卡片自動顯示警報狀態
- 實時更新數值和警報等級
- 支援拖拽和編輯功能

#### 儀表板輪播
- 輪播中的感測器自動警報檢測
- 響應式設計，支援不同螢幕尺寸
- 自動資料更新

## 技術特性

### 1. 音頻系統
- 使用 Web Audio API 生成音頻
- 不同等級對應不同頻率和音量
- 防止音頻重疊和衝突

### 2. 動畫效果
- CSS3 動畫和過渡效果
- 硬體加速支援
- 平滑的視覺反饋

### 3. 響應式設計
- 支援桌面和行動裝置
- 自適應佈局
- 觸控友好的介面

### 4. 效能優化
- 事件委託和防抖處理
- 記憶體洩漏防護
- 高效能的 DOM 操作

## 自定義配置

### 1. 修改警報樣式
```css
/* 自定義警告樣式 */
.sensor-card.warning {
    border-left: 4px solid #your-color;
    background: rgba(your-color, 0.1);
    animation: your-animation 2s infinite;
}

/* 自定義動畫 */
@keyframes your-animation {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}
```

### 2. 調整音頻參數
```javascript
// 修改音頻頻率和持續時間
const frequency = level === 'critical' ? 1000 : 600;
const duration = level === 'critical' ? 0.5 : 0.2;
```

### 3. 擴展感測器類型
```javascript
// 在 getDefaultAlertConfig 中添加新類型
newSensorType: {
    min: 0,
    max: 100,
    warning: { min: -10, max: 110 },
    danger: { min: -20, max: 120 },
    critical: { min: -30, max: 130 }
}
```

## 故障排除

### 1. 常見問題

#### 警報系統未載入
- 檢查 JavaScript 檔案是否正確引入
- 確認瀏覽器控制台是否有錯誤訊息
- 重新整理頁面

#### 音頻無法播放
- 檢查瀏覽器是否支援 Web Audio API
- 確認瀏覽器音頻權限設定
- 檢查系統音量和靜音設定

#### 警報樣式不顯示
- 檢查 CSS 檔案是否正確載入
- 確認感測器卡片元素存在
- 檢查瀏覽器相容性

### 2. 除錯方法

#### 控制台日誌
```javascript
// 啟用詳細日誌
console.log('警報系統狀態:', window.sensorAlertSystem);
console.log('當前配置:', window.sensorAlertSystem.getAlertConfig());
```

#### 手動測試
```javascript
// 在瀏覽器控制台手動觸發警報
window.sensorAlertSystem.testAlert();
```

## 最佳實踐

### 1. 閾值設定
- 根據實際環境條件調整閾值
- 避免設定過於敏感的警報
- 定期檢視和優化配置

### 2. 使用者體驗
- 警報訊息要清晰明確
- 避免過於頻繁的警報
- 提供警報確認和處理機制

### 3. 系統維護
- 定期檢查警報日誌
- 監控系統效能
- 備份重要配置

## 未來改進

### 1. 功能擴展
- 支援更多感測器類型
- 添加警報歷史記錄
- 實現警報推送通知

### 2. 使用者介面
- 支援深色主題
- 添加更多自定義選項
- 改進行動裝置體驗

### 3. 智能功能
- 機器學習異常檢測
- 預測性警報
- 自動化處理建議

## 聯絡支援

如果您在使用過程中遇到問題或有改進建議，請：

1. 檢查本說明文件
2. 查看瀏覽器控制台錯誤訊息
3. 聯繫系統管理員
4. 提交問題回報

---

**版本**: 1.0.0  
**更新日期**: 2025年1月  
**維護者**: 畜牧業管理系統團隊
