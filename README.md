# ç•œç‰§æ¥­ç®¡ç†ç³»çµ±

ä¸€å€‹åŸºæ–¼ Node.js + Express + Handlebars çš„ç•œç‰§æ¥­å ´åŸŸç®¡ç†ç³»çµ±ï¼Œæä¾›å ´åŸŸç›£æ§ã€è¨­å‚™ç®¡ç†å’Œæ•¸æ“šçµ±è¨ˆåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹è‰²

### ğŸ  Dashboard å„€è¡¨æ¿
- ç¸½è¦½æ‰€æœ‰å ´åŸŸçµ±è¨ˆè³‡è¨Š
- å³æ™‚é¡¯ç¤ºé£¼é¤Šå¤©æ•¸ã€é£¼é¤Šæ•¸é‡ã€é£²æ°´é‡ã€é¢¨æ‰‡æ•¸é‡
- å ´åŸŸç‹€æ…‹ä¸€è¦½è¡¨

### ğŸ—ºï¸ å ´åŸŸç®¡ç†
- å‰µå»ºå’Œç®¡ç†å ´åŸŸï¼ˆè¼¸å…¥ IP èˆ‡åç¨±ï¼‰
- å ´åŸŸåˆ—è¡¨æª¢è¦–ï¼Œå¯é»é¸é€²å…¥è©³ç´°é é¢
- å ´åŸŸè©³ç´°è³‡è¨Šç·¨è¼¯

### ğŸ“Š å ´åŸŸè©³ç´°åŠŸèƒ½
- ä¸Šå‚³å ´åŸŸå¹³é¢åœ–
- 2D å¹³é¢æ„Ÿæ¸¬å™¨èˆ‡è¨­å‚™ä½ˆå»º
- æ‹–æ‹½å¼ç·¨è¼¯æ¨¡å¼ï¼Œå¯èª¿æ•´è¨­å‚™ä½ç½®
- æ„Ÿæ¸¬å™¨å’Œè¨­å‚™åˆ—è¡¨ç®¡ç†

### ğŸ”§ æŠ€è¡“ç‰¹è‰²
- éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢
- ç›´è§€çš„æ‹–æ‹½ä»‹é¢
- å³æ™‚æ•¸æ“šå„²å­˜
- æª”æ¡ˆä¸Šå‚³åŠŸèƒ½

## ç³»çµ±éœ€æ±‚

- Node.js 14.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- npm 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- MongoDB 4.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- MQTT Broker (å¦‚ Mosquitto, å¯é¸)

## å®‰è£æ­¥é©Ÿ

1. ä¸‹è¼‰æˆ–è¤‡è£½å°ˆæ¡ˆ
```bash
git clone <repository-url>
cd cloud_dashboard
```

2. å®‰è£ç›¸ä¾å¥—ä»¶
```bash
npm install
```

3. å•Ÿå‹• MongoDBï¼ˆå¿…é ˆï¼‰
```bash
# macOS (ä½¿ç”¨ Homebrew)
brew services start mongodb-community

# Ubuntu/Debian
sudo systemctl start mongod

# æˆ–ä½¿ç”¨ Docker
docker run -d -p 27017:27017 --name mongodb mongo:latest
```

4. å•Ÿå‹• MQTT Brokerï¼ˆå¯é¸ï¼‰
```bash
# ä½¿ç”¨ Mosquitto
mosquitto -p 1883

# æˆ–ä½¿ç”¨ Docker
docker run -d -p 1883:1883 --name mosquitto eclipse-mosquitto
```

5. é…ç½®ç’°å¢ƒè®Šæ•¸ï¼ˆå¯é¸ï¼‰
```bash
# è¤‡è£½é…ç½®ç¯„ä¾‹
cp .env.example .env

# ç·¨è¼¯é…ç½®æª”æ¡ˆ
# MONGODB_URI=mongodb://localhost:27017/livestock_management
# MQTT_BROKER=mqtt://localhost:1883
```

6. å•Ÿå‹•ç³»çµ±
```bash
npm start
```

7. é–‹ç™¼æ¨¡å¼ï¼ˆè‡ªå‹•é‡æ–°è¼‰å…¥ï¼‰
```bash
npm run dev
```

8. é–‹å•Ÿç€è¦½å™¨è¨ªå• `http://localhost:3000`

## å°ˆæ¡ˆçµæ§‹

```
cloud_dashboard/
â”œâ”€â”€ server.js                 # ä¸»è¦ä¼ºæœå™¨æª”æ¡ˆ
â”œâ”€â”€ package.json              # å°ˆæ¡ˆé…ç½®å’Œç›¸ä¾æ€§
â”œâ”€â”€ views/                    # Handlebars æ¨¡æ¿
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ main.hbs          # ä¸»è¦ä½ˆå±€æ¨¡æ¿
â”‚   â”œâ”€â”€ dashboard.hbs         # å„€è¡¨æ¿é é¢
â”‚   â”œâ”€â”€ farms.hbs             # å ´åŸŸåˆ—è¡¨é é¢
â”‚   â”œâ”€â”€ farm-form.hbs         # å ´åŸŸè¡¨å–®é é¢
â”‚   â””â”€â”€ farm-detail.hbs       # å ´åŸŸè©³ç´°é é¢
â”œâ”€â”€ public/                   # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css         # è‡ªå®šç¾©æ¨£å¼
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js            # å‰ç«¯ JavaScript
â””â”€â”€ uploads/                  # ä¸Šå‚³æª”æ¡ˆç›®éŒ„
```

## ä½¿ç”¨èªªæ˜

### 1. å»ºç«‹å ´åŸŸ
1. é»é¸ã€Œæ–°å¢å ´åŸŸã€æŒ‰éˆ•
2. è¼¸å…¥å ´åŸŸåç¨±å’Œ IP ä½å€
3. é»é¸ã€Œå»ºç«‹å ´åŸŸã€

### 2. ç®¡ç†å ´åŸŸè©³ç´°è³‡è¨Š
1. åœ¨å ´åŸŸåˆ—è¡¨ä¸­é»é¸ã€ŒæŸ¥çœ‹è©³ç´°ã€
2. ä¸Šå‚³å ´åŸŸå¹³é¢åœ–
3. é€²å…¥ç·¨è¼¯æ¨¡å¼æ–°å¢æ„Ÿæ¸¬å™¨å’Œè¨­å‚™
4. æ‹–æ‹½èª¿æ•´è¨­å‚™ä½ç½®
5. å„²å­˜ä½ˆå±€

### 3. æ›´æ–°çµ±è¨ˆè³‡æ–™
1. åœ¨å ´åŸŸè©³ç´°é é¢é»é¸ã€Œç·¨è¼¯ã€
2. æ›´æ–°é£¼é¤Šå¤©æ•¸ã€é£¼é¤Šæ•¸é‡ç­‰è³‡è¨Š
3. å„²å­˜è®Šæ›´

### 4. è¨­å®š MQTT è¨­å‚™
1. åœ¨å ´åŸŸè©³ç´°é é¢é€²å…¥ç·¨è¼¯æ¨¡å¼
2. æ–°å¢æ„Ÿæ¸¬å™¨æˆ–è¨­å‚™æ™‚è¼¸å…¥ MQTT è¨­å‚™åç¨±
3. ç³»çµ±æœƒè‡ªå‹•è¨‚é–±å°æ‡‰çš„ MQTT ä¸»é¡Œ
4. å³æ™‚æ¥æ”¶è¨­å‚™ç‹€æ…‹æ›´æ–°

## MQTT ä¸»é¡Œçµæ§‹

ç³»çµ±æœƒè‡ªå‹•è¨‚é–±ä»¥ä¸‹ MQTT ä¸»é¡Œæ ¼å¼ï¼š

### æ§åˆ¶è¨­å‚™ç‹€æ…‹
- **ä¸»é¡Œ**: `device/{devicename}/nodeinf`
- **èªªæ˜**: æ¥æ”¶æ‰€æœ‰æ§åˆ¶è¨­å‚™çš„ç‹€æ…‹è³‡è¨Š
- **è³‡æ–™æ ¼å¼**: JSON

### æ„Ÿæ¸¬å™¨è¨­å‚™ç‹€æ…‹  
- **ä¸»é¡Œ**: `device/{devicename}/seninf`
- **èªªæ˜**: æ¥æ”¶æ„Ÿæ¸¬å™¨è¨­å‚™çš„ç‹€æ…‹è³‡è¨Š
- **è³‡æ–™æ ¼å¼**: JSON

### è¨­å‚™è³‡è¨Š
- **ä¸»é¡Œ**: `device/{devicename}/deviceinf`
- **èªªæ˜**: æ¥æ”¶è¨­å‚™è³‡è¨Šï¼ŒåŒ…å«ï¼š
  - `feeding_days`: é£¼é¤Šå¤©æ•¸
  - `device_number`: è¨­å‚™ç·¨è™Ÿ
  - `fan_count`: é¢¨æ‰‡æ•¸é‡
- **è³‡æ–™æ ¼å¼**: JSON

### MQTT è¨Šæ¯ç¯„ä¾‹

```json
// nodeinf - æ§åˆ¶è¨­å‚™ç‹€æ…‹
{
  "fan_speed": 75,
  "water_pump": "on",
  "temperature_control": "auto"
}

// seninf - æ„Ÿæ¸¬å™¨ç‹€æ…‹
{
  "temperature": 25.5,
  "humidity": 68.2,
  "water_level": 85
}

// deviceinf - è¨­å‚™è³‡è¨Š
{
  "feeding_days": 45,
  "device_number": "PF001",
  "fan_count": 8
}
```

## API è·¯ç”±

### ç¶²é è·¯ç”±
- `GET /` - å„€è¡¨æ¿é¦–é 
- `GET /farms` - å ´åŸŸåˆ—è¡¨
- `GET /farms/new` - æ–°å¢å ´åŸŸè¡¨å–®
- `POST /farms` - å»ºç«‹æ–°å ´åŸŸ
- `GET /farms/:id` - å ´åŸŸè©³ç´°é é¢
- `GET /farms/:id/edit` - ç·¨è¼¯å ´åŸŸè¡¨å–®
- `POST /farms/:id` - æ›´æ–°å ´åŸŸè³‡è¨Š
- `POST /farms/:id/upload-layout` - ä¸Šå‚³å ´åŸŸä½ˆå±€åœ–
- `POST /farms/:id/sensors-devices` - æ›´æ–°æ„Ÿæ¸¬å™¨å’Œè¨­å‚™ä½ç½®

### API è·¯ç”±
- `GET /api/system/status` - ç³»çµ±ç‹€æ…‹ï¼ˆMongoDBã€MQTT é€£æ¥ç‹€æ…‹ï¼‰
- `GET /api/farms/:id/realtime` - å ´åŸŸå³æ™‚è³‡æ–™

## æŠ€è¡“æ£§

- **å¾Œç«¯**: Node.js, Express.js
- **è³‡æ–™åº«**: MongoDB + Mongoose ODM
- **IoT é€šè¨Š**: MQTT Client
- **æ¨¡æ¿å¼•æ“**: Handlebars (HBS)
- **å‰ç«¯**: Bootstrap 5, Font Awesome, åŸç”Ÿ JavaScript
- **æª”æ¡ˆä¸Šå‚³**: Multer
- **å…¶ä»–**: UUIDï¼ˆå”¯ä¸€è­˜åˆ¥ç¬¦ç”Ÿæˆï¼‰ã€dotenvï¼ˆç’°å¢ƒè®Šæ•¸ç®¡ç†ï¼‰

## è³‡æ–™çµæ§‹

### å ´åŸŸ (Farm)
```javascript
{
  id: "å”¯ä¸€è­˜åˆ¥ç¬¦",
  name: "å ´åŸŸåç¨±",
  ip: "IPä½å€",
  layout_image: "ä½ˆå±€åœ–æª”å",
  sensors: [æ„Ÿæ¸¬å™¨é™£åˆ—],
  devices: [è¨­å‚™é™£åˆ—],
  stats: {
    feeding_days: é£¼é¤Šå¤©æ•¸,
    animal_count: é£¼é¤Šæ•¸é‡,
    water_consumption: é£²æ°´é‡,
    fan_count: é¢¨æ‰‡æ•¸é‡
  }
}
```

### æ„Ÿæ¸¬å™¨/è¨­å‚™
```javascript
{
  id: "å”¯ä¸€è­˜åˆ¥ç¬¦",
  name: "åç¨±",
  type: "é¡å‹",
  x: Xåº§æ¨™ç™¾åˆ†æ¯”,
  y: Yåº§æ¨™ç™¾åˆ†æ¯”
}
```

## è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Request ä¾†æ”¹å–„ç³»çµ±åŠŸèƒ½ã€‚

## æˆæ¬Š

MIT License

## è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠã€‚
